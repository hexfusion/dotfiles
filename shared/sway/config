# Sway config - Fresh setup for Framework 16
# Based on i3 muscle memory, optimized for Wayland

### Environment - Force dark theme for GTK apps
exec dbus-update-activation-environment --systemd GTK_THEME=Adwaita:dark

### GNOME Keyring - unlock secrets for apps like Pithos
exec eval $(gnome-keyring-daemon --start --components=secrets,ssh)
exec dbus-update-activation-environment --systemd SSH_AUTH_SOCK

### GTK Theme
set $gnome-schema org.gnome.desktop.interface
exec_always {
    gsettings set $gnome-schema gtk-theme 'Adwaita-dark'
    gsettings set $gnome-schema color-scheme 'prefer-dark'
    gsettings set $gnome-schema icon-theme 'Adwaita'
}

### Variables
set $mod Mod4
set $term foot
set $browser firefox
set $filemanager nautilus
set $editor gedit

# Directions (vim-style)
set $left h
set $down j
set $up k
set $right l

### Appearance
# Window borders
default_border pixel 2
default_floating_border normal
hide_edge_borders smart

# Gaps (subtle, modern look)
gaps inner 4
gaps outer 2
smart_gaps on

# Colors (teal/dark theme from your i3)
# class                 border  bg      text    indicator child_border
client.focused          #56737a #1e1e20 #ffffff #56737a   #56737a
client.focused_inactive #2c5159 #1e1e20 #888888 #2c5159   #2c5159
client.unfocused        #2c5159 #1e1e20 #888888 #2c5159   #2c5159
client.urgent           #eb4d4b #1e1e20 #ffffff #eb4d4b   #eb4d4b

font pango:Noto Sans Mono 10

### Output configuration (wallpaper on ALL monitors)
# Random wallpaper per monitor - handled by random-wallpaper script
# Fallback color if script hasn't run yet
output * bg #1e1e20 solid_color
exec_always ~/.local/bin/random-wallpaper

# Framework 16 internal display
output eDP-1 scale 1.5

### Input configuration
input type:keyboard {
    xkb_options caps:escape
}

input type:touchpad {
    tap enabled
    natural_scroll enabled
    dwt enabled
}

### Key bindings - Core apps (from your i3)
bindsym $mod+Return exec $term
bindsym $mod+b exec $browser
bindsym $mod+t exec $editor
bindsym $mod+m exec $filemanager
bindsym $mod+Shift+q kill

# App launcher (Super+W like your rofi setup)
bindsym $mod+w exec wofi --show drun --allow-images

# Screenshot bindings
# $mod+s: Select region, annotate with swappy (dark theme)
bindsym $mod+s exec grim -g "$(slurp)" - | GTK_THEME=Adwaita:dark swappy -f -
# $mod+Shift+s: Select region and save directly
bindsym $mod+Shift+s exec grim -g "$(slurp)" ~/Pictures/screenshots/$(date +%Y%m%d_%H%M%S).png
bindsym Print exec grim ~/Pictures/screenshots/$(date +%Y%m%d_%H%M%S).png

### Navigation
# Change focus
bindsym $mod+$left focus left
bindsym $mod+$down focus down
bindsym $mod+$up focus up
bindsym $mod+$right focus right
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# Move focused window
bindsym $mod+Shift+$left move left
bindsym $mod+Shift+$down move down
bindsym $mod+Shift+$up move up
bindsym $mod+Shift+$right move right
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

### Workspaces
set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $ws10 "10"
set $ws11 "11"
set $ws12 "12"

# Switch to workspace
bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5
bindsym $mod+6 workspace number $ws6
bindsym $mod+7 workspace number $ws7
bindsym $mod+8 workspace number $ws8
bindsym $mod+9 workspace number $ws9
bindsym $mod+0 workspace number $ws10
bindsym $mod+minus workspace number $ws11
bindsym $mod+equal workspace number $ws12

# Move container to workspace and follow
bindsym $mod+Shift+1 move container to workspace number $ws1; workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2; workspace number $ws2
bindsym $mod+Shift+3 move container to workspace number $ws3; workspace number $ws3
bindsym $mod+Shift+4 move container to workspace number $ws4; workspace number $ws4
bindsym $mod+Shift+5 move container to workspace number $ws5; workspace number $ws5
bindsym $mod+Shift+6 move container to workspace number $ws6; workspace number $ws6
bindsym $mod+Shift+7 move container to workspace number $ws7; workspace number $ws7
bindsym $mod+Shift+8 move container to workspace number $ws8; workspace number $ws8
bindsym $mod+Shift+9 move container to workspace number $ws9; workspace number $ws9
bindsym $mod+Shift+0 move container to workspace number $ws10; workspace number $ws10
bindsym $mod+Shift+minus move container to workspace number $ws11; workspace number $ws11
bindsym $mod+Shift+equal move container to workspace number $ws12; workspace number $ws12

# Move container only (Ctrl variant from your i3)
bindsym $mod+Ctrl+1 move container to workspace number $ws1
bindsym $mod+Ctrl+2 move container to workspace number $ws2
bindsym $mod+Ctrl+3 move container to workspace number $ws3
bindsym $mod+Ctrl+4 move container to workspace number $ws4
bindsym $mod+Ctrl+5 move container to workspace number $ws5
bindsym $mod+Ctrl+6 move container to workspace number $ws6
bindsym $mod+Ctrl+7 move container to workspace number $ws7
bindsym $mod+Ctrl+8 move container to workspace number $ws8
bindsym $mod+Ctrl+9 move container to workspace number $ws9
bindsym $mod+Ctrl+0 move container to workspace number $ws10
bindsym $mod+Ctrl+minus move container to workspace number $ws11
bindsym $mod+Ctrl+equal move container to workspace number $ws12

# Navigate workspaces
bindsym $mod+Ctrl+Right workspace next
bindsym $mod+Ctrl+Left workspace prev
workspace_auto_back_and_forth yes

### Layout
bindsym $mod+v splitv
bindsym $mod+g splith
bindsym $mod+e layout toggle split
bindsym $mod+f fullscreen toggle
bindsym $mod+Shift+space floating toggle
bindsym $mod+space focus mode_toggle
bindsym $mod+a focus parent

# Floating modifier
floating_modifier $mod normal

# Resize mode
mode "resize" {
    bindsym $left resize shrink width 10px
    bindsym $down resize grow height 10px
    bindsym $up resize shrink height 10px
    bindsym $right resize grow width 10px
    bindsym Left resize shrink width 10px
    bindsym Down resize grow height 10px
    bindsym Up resize shrink height 10px
    bindsym Right resize grow width 10px
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+r mode "resize"

### System controls
bindsym $mod+Shift+c reload
bindsym $mod+Shift+r exec swaymsg reload && systemctl --user restart kanshi
bindsym $mod+Shift+e exec swaynag -t warning -m 'Exit Sway?' -B 'Yes' 'swaymsg exit'
bindsym $mod+Shift+x exec swaylock -f -c 1e1e20

# Brightness (Framework laptop)
bindsym XF86MonBrightnessUp exec brightnessctl set +5%
bindsym XF86MonBrightnessDown exec brightnessctl set 5%-

# Volume
bindsym XF86AudioRaiseVolume exec wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+
bindsym XF86AudioLowerVolume exec wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindsym XF86AudioMute exec wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindsym XF86AudioMicMute exec wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle

# Media
bindsym XF86AudioPlay exec playerctl play-pause
bindsym XF86AudioNext exec playerctl next
bindsym XF86AudioPrev exec playerctl previous

### Window rules
for_window [app_id="pavucontrol"] floating enable
for_window [app_id="nm-connection-editor"] floating enable
for_window [app_id="blueman-manager"] floating enable
for_window [app_id="pithos"] floating enable
for_window [app_id="thunar" title="File Operation Progress"] floating enable
for_window [window_role="pop-up"] floating enable
for_window [window_role="dialog"] floating enable
for_window [window_type="dialog"] floating enable

### Startup
exec_always sh -c "pkill -x waybar; waybar"
exec mako
# kanshi managed by systemd (systemctl --user enable kanshi.service)
exec nm-applet --indicator
exec lxpolkit

# Idle/lock
exec swayidle -w \
    timeout 300 'swaylock -f -c 1e1e20' \
    timeout 600 'swaymsg "output * power off"' \
    resume 'swaymsg "output * power on"' \
    before-sleep 'swaylock -f -c 1e1e20'

# Create screenshot directory
exec mkdir -p ~/Pictures/screenshots

# NOTE: Speaker state is now managed by WirePlumber (persists across reboots)
# If speakers get muted, run: amixer -c 1 set 'Speaker' unmute && amixer -c 1 set 'Bass Speaker' unmute

include /etc/sway/config.d/*
